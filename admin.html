<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Product Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* Tailwind's gray-100 */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="login-container" class="flex items-center justify-center min-h-screen bg-gray-100">
        <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-sm">
            <h2 class="text-3xl font-bold text-center mb-6 text-indigo-700">Admin Login</h2>
            <form id="login-form" class="space-y-4">
                <input type="text" id="username" placeholder="Admin ID" required
                       class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <div class="relative">
                    <input type="password" id="password" placeholder="Password" required
                           class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <button type="button" id="toggle-password" class="absolute inset-y-0 right-0 px-4 text-gray-500 focus:outline-none" aria-label="Toggle password visibility">
                        <svg id="eye-open" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                        <svg id="eye-closed" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.42 3.49"></path>
                            <path d="M15 15a3 3 0 1 0-3-3"></path>
                            <line x1="1" y1="1" x2="23" y2="23"></line>
                        </svg>
                    </button>
                </div>
                <button type="submit" id="login-button"
                        class="relative w-full py-3 px-6 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 transition-colors duration-300 disabled:bg-indigo-400 disabled:cursor-not-allowed">
                    <span id="login-button-text">Login</span>
                    <svg id="login-spinner" class="hidden absolute top-1/2 left-1/2 -mt-2.5 -ml-2.5 animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>
                <p id="login-error" class="text-red-500 text-center text-sm hidden">Invalid credentials. Please try again.</p>
            </form>
        </div>
    </div>

    <div id="admin-panel" class="hidden">
        <header class="bg-white shadow-sm py-6">
            <div class="container mx-auto px-4 flex justify-between items-center">
                <div class="flex-grow text-center">
                    <h1 class="text-4xl font-extrabold text-indigo-700">Admin Panel</h1>
                    <p class="text-gray-500 mt-2">Manage your e-commerce platform.</p>
                </div>
                <button id="logout-button" class="py-2 px-6 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 transition-colors">
                    Logout
                </button>
            </div>
        </header>

        <nav class="bg-gray-200 shadow-md">
            <div class="container mx-auto px-4 py-3 flex space-x-4">
                <button id="tab-products" class="tab-button px-4 py-2 rounded-lg bg-indigo-600 text-white font-semibold transition-colors duration-200">Products</button>
                <button id="tab-users" class="tab-button px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-300 transition-colors duration-200">Users</button>
                <button id="tab-orders" class="tab-button px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-300 transition-colors duration-200">Orders</button>
            </div>
        </nav>

        <main class="container mx-auto px-4 py-8">
            <section id="section-products">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="md:col-span-1 bg-white p-8 rounded-xl shadow-lg h-fit">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800">Add/Update Product</h2>
                        <form id="product-form" class="space-y-4">
                            <input type="hidden" id="product-original-name" name="original-name">
                            <input type="text" name="name" placeholder="Name" required
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <input type="number" name="price" placeholder="Price" required
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <input type="text" name="category" placeholder="Category" required
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <input type="text" name="description" placeholder="Description" required
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <input type="number" name="stock" placeholder="Stock" required
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <input type="url" name="image" placeholder="Image URL" required
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <button type="submit" id="submit-button"
                                    class="relative w-full py-3 px-6 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 transition-colors duration-300 disabled:bg-indigo-400 disabled:cursor-not-allowed">
                                <span id="submit-button-text">Add Product</span>
                                <svg id="submit-spinner" class="hidden absolute top-1/2 left-1/2 -mt-2.5 -ml-2.5 animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                            </button>
                        </form>
                    </div>
                    <div class="md:col-span-2">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800">Product List</h2>
                        <div id="product-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-6">
                            <p class="col-span-full text-center text-gray-500">Loading products...</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="section-users" class="hidden">
                <div class="bg-white p-8 rounded-xl shadow-lg">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">User Management</h2>
                    <div class="mb-4">
                        <input type="text" id="user-search-input" placeholder="Search users by name or email..."
                               class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div id="user-list" class="space-y-4">
                        <p class="text-center text-gray-500">Loading users...</p>
                    </div>
                </div>
            </section>

            <section id="section-orders" class="hidden">
                <div class="bg-white p-8 rounded-xl shadow-lg">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">Order History</h2>
                    <div id="order-list" class="space-y-4">
                        <p class="text-center text-gray-500">Loading orders...</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // --- TOKEN MANAGEMENT FUNCTIONS ---
        function getToken() {
            return localStorage.getItem('adminToken');
        }

        function setToken(token) {
            localStorage.setItem('adminToken', token);
        }

        function removeToken() {
            localStorage.removeItem('adminToken');
        }

        // --- DOM ELEMENTS ---
        const loginContainer = document.getElementById('login-container');
        const adminPanel = document.getElementById('admin-panel');
        const loginForm = document.getElementById('login-form');
        const logoutButton = document.getElementById('logout-button');
        const loginError = document.getElementById('login-error');
        const productForm = document.getElementById('product-form');
        const productList = document.getElementById('product-list');
        const productOriginalName = document.getElementById('product-original-name');
        const submitButton = document.getElementById('submit-button');
        const submitButtonText = document.getElementById('submit-button-text');
        const submitSpinner = document.getElementById('submit-spinner');
        const loginButton = document.getElementById('login-button');
        const loginButtonText = document.getElementById('login-button-text');
        const loginSpinner = document.getElementById('login-spinner');
        const togglePassword = document.getElementById('toggle-password');
        const passwordInput = document.getElementById('password');

        const tabProducts = document.getElementById('tab-products');
        const tabUsers = document.getElementById('tab-users');
        const tabOrders = document.getElementById('tab-orders');
        const sectionProducts = document.getElementById('section-products');
        const sectionUsers = document.getElementById('section-users');
        const sectionOrders = document.getElementById('section-orders');
        const userSearchInput = document.getElementById('user-search-input');
        const userList = document.getElementById('user-list');
        const orderList = document.getElementById('order-list');
        
        let allUsers = [];

        // --- UI STATE FUNCTIONS ---
        function showLoginForm() {
            loginContainer.classList.remove('hidden');
            adminPanel.classList.add('hidden');
        }

        function showAdminPanel() {
            loginContainer.classList.add('hidden');
            adminPanel.classList.remove('hidden');
            const params = new URLSearchParams(window.location.search);
            const tab = params.get('tab');
            if (tab === 'users') {
                showSection('section-users');
                loadUsers();
            } else if (tab === 'orders') {
                showSection('section-orders');
                loadOrders();
            } else {
                showSection('section-products');
                loadProducts();
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            if (getToken()) {
                showAdminPanel();
            } else {
                showLoginForm();
            }
        });

        function showSection(sectionId) {
            const sections = [sectionProducts, sectionUsers, sectionOrders];
            sections.forEach(sec => sec.classList.add('hidden'));
            document.getElementById(sectionId).classList.remove('hidden');

            const tabs = [tabProducts, tabUsers, tabOrders];
            tabs.forEach(tab => {
                tab.classList.remove('bg-indigo-600', 'text-white', 'font-semibold');
                tab.classList.add('text-gray-600', 'hover:bg-gray-300');
            });

            const activeTab = document.getElementById(`tab-${sectionId.replace('section-', '')}`);
            activeTab.classList.add('bg-indigo-600', 'text-white', 'font-semibold');
            activeTab.classList.remove('text-gray-600', 'hover:bg-gray-300');
        }

        function updateURL(tabName) {
            const url = new URL(window.location);
            url.searchParams.set('tab', tabName);
            window.history.pushState({}, '', url);
        }

        // --- Event Listeners ---
        tabProducts.addEventListener('click', () => {
            showSection('section-products');
            loadProducts();
            updateURL('products');
        });

        tabUsers.addEventListener('click', () => {
            showSection('section-users');
            loadUsers();
            updateURL('users');
        });

        tabOrders.addEventListener('click', () => {
            showSection('section-orders');
            loadOrders();
            updateURL('orders');
        });

        // Toggle password visibility
        togglePassword.addEventListener('click', () => {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            const eyeOpen = document.getElementById('eye-open');
            const eyeClosed = document.getElementById('eye-closed');
            eyeOpen.classList.toggle('hidden');
            eyeClosed.classList.toggle('hidden');
        });

        // --- AUTHENTICATION ---
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            loginButton.disabled = true;
            loginButtonText.classList.add('hidden');
            loginSpinner.classList.remove('hidden');
            
            const username = e.target.username.value;
            const password = e.target.password.value;

            try {
                const res = await fetch('https://test-ecommerce-backend-icgy.onrender.com/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: username, password })
                });

                if (!res.ok) {
                    throw new Error('Login failed');
                }

                const data = await res.json();
                setToken(data.token);
                loginError.classList.add('hidden');
                showAdminPanel();
            } catch (err) {
                console.error('Login failed:', err);
                loginError.classList.remove('hidden');
            } finally {
                loginButton.disabled = false;
                loginButtonText.classList.remove('hidden');
                loginSpinner.classList.add('hidden');
            }
        });

        logoutButton.addEventListener('click', () => {
            removeToken();
            showLoginForm();
        });

        // --- PRODUCT MANAGEMENT ---
        productForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            submitButton.disabled = true;
            submitButtonText.classList.add('hidden');
            submitSpinner.classList.remove('hidden');

            const form = e.target;
            const originalName = form['original-name'].value;
            const product = {
                name: form.name.value,
                price: parseFloat(form.price.value),
                category: form.category.value,
                description: form.description.value,
                stock: parseInt(form.stock.value, 10),
                image: form.image.value,
            };

            const token = getToken();
            let url = 'https://test-ecommerce-backend-icgy.onrender.com/api/products';
            let method = 'POST';

            if (originalName) {
                url = `https://test-ecommerce-backend-icgy.onrender.com/api/products/${encodeURIComponent(originalName)}`;
                method = 'PUT';
            }

            try {
                const res = await fetch(url, {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(product),
                });

                if (!res.ok) {
                    if (res.status === 401 || res.status === 403) {
                        removeToken();
                        showLoginForm();
                        alert('Session expired. Please log in again.');
                    }
                    const errorData = await res.json();
                    throw new Error(errorData.message || 'Failed to save product');
                }

                form.reset();
                productOriginalName.value = '';
                submitButtonText.textContent = 'Add Product';
                loadProducts();
            } catch (err) {
                console.error('Failed to save product:', err);
                alert(err.message);
            } finally {
                submitButton.disabled = false;
                submitButtonText.classList.remove('hidden');
                submitSpinner.classList.add('hidden');
            }
        });

        function editProduct(name, price, category, description, stock, image) {
            productForm.name.value = name;
            productForm.price.value = price;
            productForm.category.value = category;
            productForm.description.value = description;
            productForm.stock.value = stock;
            productForm.image.value = image;
            productOriginalName.value = name;
            submitButtonText.textContent = 'Update Product';
        }

        async function deleteProduct(name) {
            if (!confirm(`Are you sure you want to delete ${name}?`)) return;
            const token = getToken();
            try {
                const res = await fetch(`https://test-ecommerce-backend-icgy.onrender.com/api/products/${encodeURIComponent(name)}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!res.ok) {
                    if (res.status === 401 || res.status === 403) {
                        removeToken();
                        showLoginForm();
                        alert('Session expired. Please log in again.');
                    }
                    throw new Error('Failed to delete product.');
                }
                loadProducts();
            } catch (err) {
                console.error('Delete failed:', err);
                alert('Failed to delete product.');
            }
        }

        async function loadProducts() {
            productList.innerHTML = `<p class="col-span-full text-center text-gray-500 flex items-center justify-center">
                                         <svg class="animate-spin h-5 w-5 mr-3 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                             <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                             <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                         </svg> Loading products...
                                     </p>`;

            try {
                const res = await fetch('https://test-ecommerce-backend-icgy.onrender.com/api/products');

                if (!res.ok) {
                    throw new Error('Network response was not ok.');
                }

                const products = await res.json();
                productList.innerHTML = '';
                if (products.length === 0) {
                    productList.innerHTML = '<p class="col-span-full text-center text-gray-500">No products found.</p>';
                    return;
                }
                products.forEach(p => {
                    const productDiv = document.createElement('div');
                    productDiv.className = `bg-white p-4 rounded-xl shadow-sm border border-gray-200 flex items-center space-x-4`;
                    productDiv.innerHTML = `
                        <div class="flex-shrink-0">
                            <img src="${p.image}" alt="${p.name}" class="w-16 h-16 object-cover rounded-lg">
                        </div>
                        <div class="flex-1">
                            <h3 class="text-lg font-bold text-gray-900">${p.name}</h3>
                            <p class="text-sm text-gray-600">Price: <span class="font-semibold">$${p.price}</span></p>
                            <p class="text-xs text-gray-500">Category: ${p.category}</p>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="editProduct('${p.name.replace(/'/g, "\\'")}', '${p.price}', '${p.category.replace(/'/g, "\\'")}', '${p.description.replace(/'/g, "\\'")}', '${p.stock}', '${p.image.replace(/'/g, "\\'")}')" class="flex-shrink-0 p-2 text-sm bg-indigo-500 text-white rounded-md hover:bg-indigo-600 transition-colors">
                                Edit
                            </button>
                            <button onclick="deleteProduct('${p.name.replace(/'/g, "\\'")}')" class="flex-shrink-0 p-2 text-sm bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors">
                                Delete
                            </button>
                        </div>
                    `;
                    productList.appendChild(productDiv);
                });
            } catch (err) {
                console.error('Failed to load products:', err);
                productList.innerHTML = '<p class="col-span-full text-center text-red-500">Failed to load products.</p>';
            }
        }

        // --- User Management Functions ---
        async function loadUsers() {
            userList.innerHTML = `<p class="text-center text-gray-500 flex items-center justify-center">
                                    <svg class="animate-spin h-5 w-5 mr-3 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg> Loading users...
                                  </p>`;

            try {
                const res = await fetch('https://test-ecommerce-backend-icgy.onrender.com/api/users', {
                    headers: { 'Authorization': `Bearer ${getToken()}` }
                });

                if (!res.ok) {
                    if (res.status === 401 || res.status === 403) {
                        removeToken();
                        showLoginForm();
                        alert('Session expired. Please log in again.');
                    }
                    throw new Error('Failed to load users.');
                }
                
                allUsers = await res.json();
                renderUsers(allUsers);
            } catch (err) {
                console.error('Failed to load users:', err);
                userList.innerHTML = '<p class="text-center text-red-500">Failed to load users.</p>';
            }
        }

        function renderUsers(users) {
            userList.innerHTML = '';
            if (users.length === 0) {
                userList.innerHTML = '<p class="text-center text-gray-500">No users found.</p>';
                return;
            }
            users.forEach(user => {
                const userDiv = document.createElement('div');
                userDiv.className = `bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200 flex justify-between items-center`;
                userDiv.innerHTML = `
                    <div>
                        <p class="font-bold text-lg text-gray-900">${user.name}</p>
                        <p class="text-sm text-gray-600">${user.email}</p>
                    </div>
                    <button onclick="deleteUser('${user.email.replace(/'/g, "\\'")}')" class="flex-shrink-0 p-2 text-sm bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors">
                        Delete
                    </button>
                `;
                userList.appendChild(userDiv);
            });
        }

        async function deleteUser(email) {
            if (!confirm(`Are you sure you want to delete the user with email: ${email}?`)) return;
            const token = getToken();
            try {
                const res = await fetch(`https://test-ecommerce-backend-icgy.onrender.com/api/users/${encodeURIComponent(email)}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (!res.ok) {
                    if (res.status === 401 || res.status === 403) {
                        removeToken();
                        showLoginForm();
                        alert('Session expired. Please log in again.');
                    }
                    throw new Error('Failed to delete user.');
                }
                
                await res.json();
                loadUsers();
            } catch (err) {
                console.error('Delete failed:', err);
                alert('Failed to delete user.');
            }
        }

        userSearchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredUsers = allUsers.filter(user => 
                user.name.toLowerCase().includes(searchTerm) || user.email.toLowerCase().includes(searchTerm)
            );
            renderUsers(filteredUsers);
        });

        // --- Order Management Functions ---
        async function loadOrders() {
            orderList.innerHTML = `<p class="text-center text-gray-500 flex items-center justify-center">
                                     <svg class="animate-spin h-5 w-5 mr-3 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                         <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                         <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                     </svg> Loading orders...
                                  </p>`;

            try {
                const res = await fetch('https://test-ecommerce-backend-icgy.onrender.com/api/orders', {
                    headers: { 'Authorization': `Bearer ${getToken()}` }
                });

                if (!res.ok) {
                    if (res.status === 401 || res.status === 403) {
                        removeToken();
                        showLoginForm();
                        alert('Session expired. Please log in again.');
                    }
                    throw new Error('Failed to load orders.');
                }
                
                const orders = await res.json();
                renderOrders(orders);
            } catch (err) {
                console.error('Failed to load orders:', err);
                orderList.innerHTML = '<p class="text-center text-red-500">Failed to load orders.</p>';
            }
        }

        function renderOrders(orders) {
            orderList.innerHTML = '';
            if (orders.length === 0) {
                orderList.innerHTML = '<p class="text-center text-gray-500">No orders found.</p>';
                return;
            }
            orders.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            orders.forEach(order => {
                const orderDiv = document.createElement('div');
                orderDiv.className = `bg-gray-50 p-6 rounded-lg shadow-sm border border-gray-200`;
                const orderItemsHtml = order.items.map(item => `
                    <li class="flex items-center space-x-2">
                        <img src="${item.image}" alt="${item.name}" class="w-8 h-8 rounded-md object-cover">
                        <span class="text-sm font-medium text-gray-700">${item.name}</span>
                        <span class="text-xs text-gray-500">(${item.quantity} x $${item.price})</span>
                    </li>
                `).join('');

                const orderTotal = order.items.reduce((sum, item) => sum + (item.price * item.quantity), 0).toFixed(2);

                orderDiv.innerHTML = `
                    <div class="flex items-center justify-between mb-2 pb-2 border-b border-gray-200">
                        <h3 class="font-bold text-gray-900">Order #${order.orderId}</h3>
                        <span class="text-xs text-gray-500">${new Date(order.createdAt).toLocaleString()}</span>
                    </div>
                    <p class="text-sm text-gray-600 mb-2">
                        <span class="font-semibold">Customer:</span> ${order.shipping.name || order.user.email}
                    </p>
                    <p class="text-sm text-gray-600 mb-2">
                        <span class="font-semibold">Address:</span> ${order.shipping.address}
                    </p>
                        <p class="text-sm text-gray-600 mb-2">
                         <span class="font-semibold">Number:</span> ${order.shipping.phone}
                     </p>
                    <p class="text-sm text-gray-600 mb-2">
                        <span class="font-semibold">Total:</span> $<span class="font-bold text-indigo-700">${orderTotal}</span>
                    </p>
                    <p class="text-sm text-gray-600 mb-2">
                        <span class="font-semibold">Payment method:</span> <span class="text-green-600">${order.payment.method}</span>
                    </p>
                    <ul class="space-y-1 mt-3">
                        ${orderItemsHtml}
                    </ul>
                `;
                orderList.appendChild(orderDiv);
            });
        }
    </script>
</body>
</html>